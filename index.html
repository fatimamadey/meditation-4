<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js?v=1"></script>
<!--API: https://www.themealdb.com/api.php-->
	<script>
  /* global nn */
  
  const url = 'https://www.themealdb.com/api/json/v1/1/random.php' // generates a random recipe
  // const url = 'https://www.themealdb.com/api/json/v1/1/lookup.php?i=52772' // for testing
  let allMeals = []
  
  async function getRandomRecipe() {
    const res = await fetch(url) 
	    const json = await res.json()
    let meal = json.meals[0]
    
    let mealData = {
      name: meal.strMeal.split(" "),
      area: meal.strArea,
      ingredients: [],
      measurements: [],
      instructions: meal.strInstructions.split("."),
      img: meal.strMealThumb
    }
    
    for (let i = 0; i < 20; i++) {
      let ingredient = "strIngredient" + (i + 1)
      let measurement = "strMeasure" + (i + 1)
      if (meal[ingredient]){ // removes empty strings and null values
        mealData.ingredients.push(meal[ingredient])
      }
      if (meal[measurement]){
        mealData.measurements.push(meal[measurement])
      }
    }
    return mealData
  }
  
  function randomElement(arr) {
    return nn.random(arr)
  }
  
	  async function setup () {
    // get the info for 4 recipe
    for(let i = 0; i < 4; i++){
      const meal = await getRandomRecipe()
      allMeals.push(meal)
    }
    console.log("All meals fetched:", allMeals)
      
    // frakenstein the recipe
    let mealName = "" // choose one word from each meal
    let mealArea= "" // combine all the areas in the meals, removed duplicartes and add fusion at the end
    let mealIngredients = [] // pick 8 random ingredients w/measuments
    let mealInstructions = "" // pick 8  random instructions
    
    for(let i = 0; i < 4; i++){
      mealName += nn.random(allMeals[i].name).toUpperCase() + " "
      
      mealArea += allMeals[i].area + " "
      
      
      mealIngredients.push(nn.random(allMeals[i].ingredients) + " --- " + nn.random(allMeals[i].measurements))
      mealInstructions += nn.random(allMeals[i].instructions) + ". "
      
      
      mealIngredients.push(nn.random(allMeals[i].ingredients) + " --- " + nn.random(allMeals[i].measurements))
      mealInstructions += nn.random(allMeals[i].instructions) + ". "
    }
    console.log("Title:", mealName)
    mealArea += "Fusion"
    console.log("Cusine:", mealArea)
    console.log("Ingredients:", mealIngredients)
    console.log("Instructions:", mealInstructions)

  // recipe card container
  let recipeBox = nn.create('div')
    .css({
      border: '4px dashed hotpink',
      backgroundColor: '#fff0f5',
      padding: '20px',
      borderRadius: '20px',
      width: '600px',
      fontFamily: 'Comic Sans MS, cursive, sans-serif',
      margin: '20px auto',
      textAlign: 'center'
    })
    .addTo('body');

  // image collage
  let collage = nn.create('div')
    .css({
      position: 'relative',
      width: '200px',
      height: '200px',
      margin: '0 auto 20px auto',
      border: '4px solid hotpink',
      borderRadius: '15px',
    })
    .addTo(recipeBox);

  let positions = [
    { top: 0, left: 0 },
    { top: 0, left: '100px' },
    { top: '100px', left: 0 },
    { top: '100px', left: '100px' }
  ];

  for (let i = 0; i < 4; i++) {
    nn.create('img')
      .set('src', allMeals[i].img)
      .css({
        position: 'absolute',
        top: positions[i].top,
        left: positions[i].left,
        width: '100px',
        height: '100px',
      })
      .addTo(collage);
  }

  // title
  nn.create('h2')
    .content(`--- ${mealName} ---`)
    .css({color: '#db7093'})
    .addTo(recipeBox);

  // cuisine
  nn.create('p')
    .content(`ðŸ‘©â€ðŸ³ Cuisine Type: ${mealArea}`)
    .css({ fontSize: '14px', color: '#555' })
    .addTo(recipeBox);

  // ingredients List
  nn.create('h3')
    .content('ðŸ§‚ Ingredients')
    .css({ color: '#db7093' })
    .addTo(recipeBox);

  let ingredientsList = nn.create('ul')
    .css({textAlign: 'left'})
    .addTo(recipeBox);

  mealIngredients.forEach(item => {
    nn.create('li')
      .content(item)
      .addTo(ingredientsList)
  });

  // instructions
  nn.create('h3')
    .content('ðŸ“– Instructions')
    .css({ color: '#db7093'})
    .addTo(recipeBox)

  nn.create('p')
    .content(mealInstructions)
    .css({fontSize: '14px', textAlign: 'left'})
    .addTo(recipeBox)
}
	  
	nn.on('load', setup)
	</script>